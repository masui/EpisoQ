#!/usr/bin/ruby
# coding: utf-8
#
# Scrapbox上にリストしたなぞなぞ問題プールからランダムに問題を選択してeasy.htmlを開く
# https://github.com/masui/EpisoQ/
#
# データ例: https://Scrapbox.io/masui/県名なぞなぞ
#
# % episoq masui 県名なぞなぞ 3
#

require 'net/https'
require 'uri'
require 'json'

project = ARGV[0]    || 'masui'
pagetitle = ARGV[1]  || '県名なぞなぞ'
nquestions = ARGV[2] || 10
js = ARGV[3]         || 'episopass.js'

api = "https://scrapbox.io/api/code/#{project}/#{URI.encode(pagetitle)}/#{js}"
uri = URI.parse(api)
res = Net::HTTP.get_response(uri)

eval "$" + res.body # qa = { "questions":[...] }

url = "http://EpisoPass.com/easy.html?" +
      "questions=#{$qa[:questions].shuffle[0...nquestions.to_i].join(';')}" +
      "&" +
      "answers=#{$qa[:answers].join(';')}"

system "open '#{url}'"


